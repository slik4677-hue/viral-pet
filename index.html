<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>STATE WARS ‚Äî TELEGRAM ONLY</title>

<style>
body {
  margin:0;
  background:#050505;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,Arial;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
  text-align:center;
}
.screen { display:none; max-width:420px; padding:24px; }
.screen.active { display:block; }

h1 { font-size:26px; margin-bottom:10px; }
h2 { font-size:20px; margin-bottom:14px; }

button {
  width:100%;
  padding:16px;
  font-size:16px;
  font-weight:bold;
  border:none;
  border-radius:10px;
  margin-top:12px;
  cursor:pointer;
}

.primary { background:#ff3b3b; color:#000; }
.secondary { background:#222; color:#fff; border:1px solid #444; }

.warning { color:#ff3b3b; font-weight:bold; }
.small { font-size:13px; opacity:.7; margin-top:10px; }

.bar {
  width:100%;
  height:14px;
  background:#222;
  border-radius:7px;
  overflow:hidden;
  margin:14px 0;
}
.fill {
  height:100%;
  background:#ff3b3b;
  width:0%;
  transition:width .3s;
}

.timer {
  margin-top:10px;
  font-size:14px;
  letter-spacing:1px;
}
</style>
</head>

<body>

<div id="select" class="screen active">
  <h1>STATE WARS</h1>
  <p class="small">Americans are choosing sides right now.</p>

  <button class="secondary" onclick="chooseState('TEXAS')">ü§† TEXAS</button>
  <button class="secondary" onclick="chooseState('CALIFORNIA')">üå¥ CALIFORNIA</button>
  <button class="secondary" onclick="chooseState('NEW YORK')">üóΩ NEW YORK</button>
  <button class="secondary" onclick="chooseState('FLORIDA')">üêä FLORIDA</button>
  <button class="secondary" onclick="chooseState('OHIO')">üíÄ OHIO</button>
</div>

<div id="main" class="screen">
  <h2 id="stateTitle"></h2>

  <p class="warning">YOUR STATE IS LOSING</p>
  <p class="small">You are responsible for what happens next.</p>

  <div class="bar">
    <div id="progress" class="fill"></div>
  </div>

  <p id="statusText" class="small"></p>

  <button class="primary" onclick="invite()">DEFEND YOUR STATE</button>

  <div class="timer" id="timer"></div>
</div>

<script>
/* ================================
   TELEGRAM CONTEXT
================================ */
let tgUserId = "anon";
try {
  if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe?.user?.id) {
    tgUserId = Telegram.WebApp.initDataUnsafe.user.id;
  }
} catch(e){}

/* ================================
   CONFIG
================================ */
const WAR_DURATION = 24 * 60 * 60 * 1000; // 24h
const WAR_START = Number(localStorage.getItem("war_start")) || Date.now();
localStorage.setItem("war_start", WAR_START);

/* ================================
   STATE
================================ */
let myState = localStorage.getItem("my_state");
let invites = Number(localStorage.getItem("invites") || 0);

/* ================================
   UI
================================ */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* ================================
   START
================================ */
if(myState) startGame();

function chooseState(s){
  myState = s;
  localStorage.setItem("my_state", s);
  startGame();
}

function startGame(){
  show("main");
  document.getElementById("stateTitle").innerText = myState;
  update();
}

/* ================================
   LOGIC
================================ */
function update() {
  const now = Date.now();
  const passed = now - WAR_START;
  const timeLeft = Math.max(0, WAR_DURATION - passed);

  let baseProgress = Math.min(95, Math.floor(passed / WAR_DURATION * 100));
  let userImpact = Math.min(40, invites * 5);
  let total = Math.min(100, baseProgress + userImpact);

  document.getElementById("progress").style.width = total + "%";

  const status = document.getElementById("statusText");
  if (invites === 0) {
    status.innerText = "No one joined because of you.";
  } else {
    status.innerText = "People recruited by you: " + invites;
  }

  const h = Math.floor(timeLeft / 3600000);
  const m = Math.floor(timeLeft / 60000) % 60;
  document.getElementById("timer").innerText =
    "WAR ENDS IN " + h + "h " + m + "m";
}

  const h = Math.floor(timeLeft / 3600000);
  const m = Math.floor(timeLeft / 60000) % 60;
  document.getElementById("timer").innerText =
    "WAR ENDS IN " + h + "h " + m + "m";
}

/* ================================
   INVITE
================================ */
function invite(){
  invites++;
  localStorage.setItem("invites", invites);

  // Telegram deep-link (—Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ)
  const link =
    "https://t.me/YOUR_BOT_USERNAME?start=state_" +
    myState +
    "from" +
    tgUserId;

  if(navigator.vibrate) navigator.vibrate([30,30]);

  navigator.clipboard?.writeText(link);
  alert("Invite link copied.\nYour state depends on you.");

  update();
}

setInterval(update, 30000);
</script>

</body>
</html>